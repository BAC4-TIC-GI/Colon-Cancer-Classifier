
{% extends 'base.html' %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6">
    <h2 class="text-xl font-semibold mb-4">Enter Patient and Feature Information</h2>

    <!-- Display error message if it exists -->
    {% if error %}
        <div class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-md">
            <strong>Error:</strong> {{ error }}
        </div>
    {% endif %}

    <form method="post" class="space-y-6" id="featureForm">
        {% csrf_token %}

        <!-- Patient Information -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="patient_name" class="block text-sm font-medium text-gray-700">Patient Name</label>
                <input type="text" id="patient_name" name="patient_name" 
                       class="border p-1 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" 
                       required maxlength="100">
            </div>
            <div>
                <label for="patient_age" class="block text-sm font-medium text-gray-700">Age</label>
                <input type="number" id="patient_age" name="patient_age" min="0" max="150"
                       class="border p-1 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" 
                       required>
            </div>
            <div>
                <label for="patient_gender" class="block text-sm font-medium text-gray-700">Gender</label>
                <select id="patient_gender" name="patient_gender" 
                        class="border p-1 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" 
                        required>
                    <option value="M">Male</option>
                    <option value="F">Female</option>
                    <option value="O">Other</option>
                </select>
            </div>
        </div>

        <!-- Feature Inputs -->
        <div id="featureInputs" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="feature-input flex items-end gap-2">
                <div class="flex-1">
                    <label for="feature1" class="block text-sm font-medium text-gray-700">Feature 1</label>
                    <input type="number" step="any" id="feature1" name="feature1" 
                           class="border p-1 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" 
                           required>
                </div>
            </div>
        </div>

        <div class="flex justify-between items-center">
            <button type="button" id="addFeature" 
                    class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                Add New Feature
            </button>
            <button type="submit" 
                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Predict
            </button>
        </div>
    </form>
</div>

<script>
document.getElementById('addFeature').addEventListener('click', function() {
    const featureInputs = document.getElementById('featureInputs');
    const featureCount = featureInputs.children.length + 1;
    
    const featureDiv = document.createElement('div');
    featureDiv.className = 'feature-input flex items-end gap-2';
    
    const inputWrapper = document.createElement('div');
    inputWrapper.className = 'flex-1';
    
    const label = document.createElement('label');
    label.htmlFor = `feature${featureCount}`;
    label.className = 'block text-sm font-medium text-gray-700';
    label.textContent = `Feature ${featureCount}`;
    
    const input = document.createElement('input');
    input.type = 'number';
    input.step = 'any';
    input.id = `feature${featureCount}`;
    input.name = `feature${featureCount}`;
    input.className = 'border p-1 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500';
    input.required = true;
    
    const removeButton = document.createElement('button');
    removeButton.type = 'button';
    removeButton.className = 'px-2 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2';
    removeButton.textContent = 'Remove';
    removeButton.addEventListener('click', function() {
        featureDiv.remove();
        updateFeatureLabels();
    });
    
    inputWrapper.appendChild(label);
    inputWrapper.appendChild(input);
    featureDiv.appendChild(inputWrapper);
    featureDiv.appendChild(removeButton);
    featureInputs.appendChild(featureDiv);
});

function updateFeatureLabels() {
    const featureInputs = document.getElementById('featureInputs').children;
    Array.from(featureInputs).forEach((div, index) => {
        const label = div.querySelector('label');
        const input = div.querySelector('input');
        const featureNumber = index + 1;
        label.htmlFor = `feature${featureNumber}`;
        label.textContent = `Feature ${featureNumber}`;
        input.id = `feature${featureNumber}`;
        input.name = `feature${featureNumber}`;
    });
}
</script>
{% endblock %}